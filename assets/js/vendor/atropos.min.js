/**
 * Atropos 1.0.1
 * Touch-friendly 3D parallax hover effects
 * https://atroposjs.com
 *
 * Copyright 2021-2021 
 *
 * Released under the MIT License
 *
 * Released on: October 18, 2021
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Atropos=e()}(this,function(){"use strict";function t(){return(t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&(t[a]=o[a])}return t}).apply(this,arguments)}var e=function t(e,o){return e.querySelector(o)},o=function t(e){void 0===e&&(e={});var o={};return Object.keys(e).forEach(function(t){void 0!==e[t]&&(o[t]=e[t])}),o};return function a(n){void 0===n&&(n={});var r,i,s,p,c,u,f,l,d,$,v,h=n,y=h.el,m=h.eventsEl,g={__atropos__:!0,params:t({alwaysActive:!1,activeOffset:50,shadowOffset:50,shadowScale:1,duration:300,rotate:!0,rotateTouch:!0,rotateXMax:15,rotateYMax:15,rotateXInvert:!1,rotateYInvert:!1,stretchX:0,stretchY:0,stretchZ:0,commonOrigin:!0,shadow:!0,highlight:!0,onEnter:null,onLeave:null,onRotate:null},o(n||{})),destroyed:!1,isActive:!1},_=g.params,x=[];!function t(){v=requestAnimationFrame(function(){x.forEach(function(t){if("function"==typeof t)t();else{var e=t.element,o=t.prop,a=t.value;e.style[o]=a}}),x.splice(0,x.length),t()})}();var w,X,Y=function t(e,o){x.push({element:e,prop:"transitionDuration",value:o})},O=function t(e,o){x.push({element:e,prop:"transitionTimingFunction",value:o})},L=function t(e,o){x.push({element:e,prop:"transform",value:o})},T=function t(e,o){x.push({element:e,prop:"opacity",value:o})},A=function t(e,o){x.push({element:e,prop:"transformOrigin",value:o})},M=function t(e,o,a,n){return e.addEventListener(o,a,n)},b=function t(e,o,a,n){return e.removeEventListener(o,a,n)},E=function t(e){var o,a=e.rotateXPercentage,n=void 0===a?0:a,r=e.rotateYPercentage,i=void 0===r?0:r,s=e.duration,p=e.opacityOnly,c=e.easeOut,u=function t(e){if(e.dataset.atroposOpacity&&"string"==typeof e.dataset.atroposOpacity)return e.dataset.atroposOpacity.split(";").map(function(t){return parseFloat(t)})};(o=y).querySelectorAll("[data-atropos-offset], [data-atropos-opacity]").forEach(function(t){Y(t,s),O(t,c?"ease-out":"");var e=u(t);if(0===n&&0===i)p||L(t,"translate3d(0, 0, 0)"),e&&T(t,e[0]);else{var o=parseFloat(t.dataset.atroposOffset)/100;if(Number.isNaN(o)||p||L(t,"translate3d("+-(-i*o)+"%, "+-(n*o)+"%, 0)"),e){var a,r=e[0];T(t,r+(e[1]-r)*Math.max(Math.abs(n),Math.abs(i))/100)}}})},R=function t(e,o){var a,n=y!==m;if(p||(p=y.getBoundingClientRect()),n&&!c&&(c=m.getBoundingClientRect()),void 0===e&&void 0===o){var i=n?c:p;e=i.left+i.width/2,o=i.top+i.height/2}var s=0,u=0,l=p,d=l.top,$=l.left,v=l.width,h=l.height;if(n){var g=c,x=g.top,w=g.left,X=g.width,M=g.height,b=e-w,R=o-x;u=-(_.rotateYMax*(b-(v/2+($-w)))/(X-v/2)*1),s=_.rotateXMax*(R-(h/2+(d-x)))/(M-h/2),a=e-$+"px "+(o-d)+"px"}else{var I=e-$,P=o-d;u=-(_.rotateYMax*(I-v/2)/(v/2)*1),s=_.rotateXMax*(P-h/2)/(h/2)}s=Math.min(Math.max(-s,-_.rotateXMax),_.rotateXMax),_.rotateXInvert&&(s=-s),u=Math.min(Math.max(-u,-_.rotateYMax),_.rotateYMax),_.rotateYInvert&&(u=-u);var D,C=s/_.rotateXMax*100,S=u/_.rotateYMax*100,k=(n?S/100*_.stretchX:0)*(_.rotateYInvert?-1:1);L(r,"translate3d("+k+"%, "+-((n?C/100*_.stretchY:0)*(_.rotateXInvert?-1:1))+"%, "+-(n?Math.max(Math.abs(C),Math.abs(S))/100*_.stretchZ:0)+"px) rotateX("+s+"deg) rotateY("+u+"deg)"),a&&_.commonOrigin&&A(r,a),f&&(Y(f,_.duration+"ms"),O(f,"ease-out"),L(f,"translate3d("+-(.25*S)+"%, "+.25*C+"%, 0)"),T(f,Math.max(Math.abs(C),Math.abs(S))/100)),E({rotateXPercentage:C,rotateYPercentage:S,duration:_.duration+"ms",easeOut:!0}),"function"==typeof _.onRotate&&_.onRotate(s,u)},I=function t(){x.push(function(){return y.classList.add("atropos-active")}),Y(r,_.duration+"ms"),O(r,"ease-out"),L(i,"translate3d(0,0, "+_.activeOffset+"px)"),Y(i,_.duration+"ms"),O(i,"ease-out"),u&&(Y(u,_.duration+"ms"),O(u,"ease-out")),g.isActive=!0},P=function t(e){if(l=void 0,("pointerdown"!==e.type||"mouse"!==e.pointerType)&&("pointerenter"!==e.type||"mouse"===e.pointerType)){if("pointerdown"===e.type&&e.preventDefault(),d=e.clientX,$=e.clientY,_.alwaysActive){p=void 0,c=void 0;return}I(),"function"==typeof _.onEnter&&_.onEnter()}},D=function t(e){!1===l&&e.cancelable&&e.preventDefault()},C=function t(e){if(_.rotate&&g.isActive){if("mouse"!==e.pointerType){if(!_.rotateTouch)return;e.preventDefault()}var o=e.clientX,a=e.clientY,n=o-d,r=a-$;if("string"==typeof _.rotateTouch&&(0!==n||0!==r)&&void 0===l){if(n*n+r*r>=25){var i=180*Math.atan2(Math.abs(r),Math.abs(n))/Math.PI;l="scroll-y"===_.rotateTouch?i>45:90-i>45}!1===l&&(y.classList.add("atropos-rotate-touch"),e.cancelable&&e.preventDefault())}("mouse"===e.pointerType||!l)&&R(o,a)}},S=function t(e){if(p=void 0,c=void 0,g.isActive&&(!e||"pointerup"!==e.type||"mouse"!==e.pointerType)&&(!e||"pointerleave"!==e.type||"mouse"===e.pointerType)){if("string"==typeof _.rotateTouch&&l&&y.classList.remove("atropos-rotate-touch"),_.alwaysActive){R(),"function"==typeof _.onRotate&&_.onRotate(0,0),"function"==typeof _.onLeave&&_.onLeave();return}x.push(function(){return y.classList.remove("atropos-active")}),Y(i,_.duration+"ms"),O(i,""),L(i,"translate3d(0,0, 0px)"),u&&(Y(u,_.duration+"ms"),O(u,"")),f&&(Y(f,_.duration+"ms"),O(f,""),L(f,"translate3d(0, 0, 0)"),T(f,0)),Y(r,_.duration+"ms"),O(r,""),L(r,"translate3d(0,0,0) rotateX(0deg) rotateY(0deg)"),E({duration:_.duration+"ms"}),g.isActive=!1,"function"==typeof _.onRotate&&_.onRotate(0,0),"function"==typeof _.onLeave&&_.onLeave()}},k=function t(e){var o=e.target;!m.contains(o)&&o!==m&&g.isActive&&S()},q=function t(){g.destroyed=!0,cancelAnimationFrame(v),b(document,"click",k),b(m,"pointerdown",P),b(m,"pointerenter",P),b(m,"pointermove",C),b(m,"touchmove",D),b(m,"pointerleave",S),b(m,"pointerup",S),b(m,"lostpointercapture",S),delete y.__atropos__};return g.destroy=q,"string"==typeof y&&(y=e(document,y)),y&&(y.__atropos__||(void 0!==m?"string"==typeof m&&(m=e(document,m)):m=y,Object.assign(g,{el:y}),r=e(y,".atropos-rotate"),i=e(y,".atropos-scale"),s=e(y,".atropos-inner"),y.__atropos__=g)),y&&m&&(_.shadow&&((u=e(y,".atropos-shadow"))||((u=document.createElement("span")).classList.add("atropos-shadow"),w=!0),L(u,"translate3d(0,0,-"+_.shadowOffset+"px) scale("+_.shadowScale+")"),w&&r.appendChild(u)),_.highlight&&((f=e(y,".atropos-highlight"))||((f=document.createElement("span")).classList.add("atropos-highlight"),X=!0),L(f,"translate3d(0,0,0)"),X&&s.appendChild(f)),_.rotateTouch&&("string"==typeof _.rotateTouch?y.classList.add("atropos-rotate-touch-"+_.rotateTouch):y.classList.add("atropos-rotate-touch")),e(y,"[data-atropos-opacity]")&&E({opacityOnly:!0}),M(document,"click",k),M(m,"pointerdown",P),M(m,"pointerenter",P),M(m,"pointermove",C),M(m,"touchmove",D),M(m,"pointerleave",S),M(m,"pointerup",S),M(m,"lostpointercapture",S),_.alwaysActive&&(I(),R())),g}});